<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Your Profile</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <link href="assets/css/bootstrap.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">
  <link href="assets/css/responsive.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }



    .body{
      max-width: 100vw;
      background: white;
      border-bottom : 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .profile-header {
      background: linear-gradient(135deg, #7e941b 0%, #d1d1b3 100%);
      color: white;
      padding: 3rem 2rem;
      text-align: center;
      position: relative;
    }

    .profile-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="60" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.3;
    }

    .profile-header h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 1;
    }

    .profile-subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }

    .content-wrapper {
      padding: 2.5rem;
    }

    .section-card {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .section-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .section-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #0dd628, #e6ece8);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.1rem;
    }

    .info-grid {
      display: grid;
      gap: 1rem;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background: linear-gradient(135deg, #f8fafc, #e2f0e4);
      border-radius: 12px;
      border-left: 4px solid #43c522;
    }

    .info-label {
      font-weight: 600;
      color: #4a5568;
    }

    .info-value {
      font-weight: 700;
      color: #485dbd;
    }

    .progress-item {
      margin-bottom: 1.5rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, #f7fafc, #edf2f7);
      border-radius: 12px;
      border: 1px solid rgba(102, 126, 234, 0.1);
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .course-name {
      font-weight: 600;
      color: #2d3748;
      font-size: 1.1rem;
    }

    .progress-percentage {
      font-weight: 700;
      color: #667eea;
      font-size: 1.1rem;
    }

    .progress-bar {
      height: 8px;
      background: rgba(102, 234, 124, 0.2);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #abc7ac, #764ba2);
      border-radius: 10px;
      transition: width 0.8s ease;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(105, 177, 83, 0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    .referral-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      text-align: center;
      padding: 1.5rem;
      background: linear-gradient(135deg, #50b861, #14ac46);
      color: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .referral-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.2rem;
      background: linear-gradient(135deg, #f8fafc, #edf2f7);
      border-radius: 12px;
      margin-bottom: 1rem;
      border-left: 4px solid  #43c522;
      transition: all 0.3s ease;
    }

    .referral-item:hover {
      transform: translateX(5px);
      background: linear-gradient(135deg, #edf2f7, #e2e8f0);
    }

    .referral-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #48da8a, #dfeb3c);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 1.2rem;
    }

    .referral-info h6 {
      margin: 0 0 0.25rem 0;
      font-weight: 600;
      text-overflow: ellipsis;
      color: #2d3748;
    }

    .referral-info small {
      color: #64748b;
    }

    .logout-btn {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      border: none;
      padding: 1rem 2.5rem;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
      display: block;
      margin: 2rem auto 0;
    }

    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }

    .no-data {
      text-align: center;
      color: #64748b;
      font-style: italic;
      padding: 2rem;
    }

    .notification-item {
      margin-bottom: 1rem;
    }

    @media (max-width: 768px) {
      .main-container {
        margin: 1rem;
        border-radius: 16px;
      }

      .profile-header {
        padding: 2rem 1.5rem;
      }

      .profile-header h1 {
        font-size: 2.2rem;
      }

      .content-wrapper {
        padding: 1.5rem;
      }

      .section-card {
        padding: 1.5rem;
      }

      .info-item {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
      }
    }
  </style>
</head>

<body>
  <div class="main-container">
    <!-- Cursor -->
    <div class="cursor"></div>
    <div class="cursor-follower"></div>
    <!-- Cursor End -->

    <!-- Main Header -->
    <header class="main-header">

      <!-- Header Top -->
      <div class="header-top">
        <div class="auto-container">
          <div class="inner-container">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
              <div class="left-box d-flex align-items-center flex-wrap">
                <!-- Info List -->
                <ul class="header-top_list">
                  <li><span class="icon fa-solid fa-envelope fa-fw"></span>asteptowardshaq@gmail.com</li>
                  <!-- <li><span class="icon fa-solid fa-envelope fa-fw"></span>hello123@gmail.com</li> -->
                </ul>
              </div>
              <img src="assets/images/icons/bismillah.png" class="plass">
              <ul class="header-top_list-two">
                <li><span class="icon fa-regular fa-sun fa-fw"></span>Sunrise At: 5:15 AM</li>
                <li><span class="icon fa-solid fa-moon fa-fw"></span>Sunset At: 4:50 PM</li>
                <li><span class="icon fa-solid fa-phone fa-fw"></span>Let’s Talk +92 326 1420047</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Header Upper -->
      <div class="header-upper">
        <div class="auto-container">
          <div class="inner-container">
            <div class="d-flex justify-content-between align-items-center flex-wrap">

              <div class="logo-box">
                <div class="logo"><a href="index.html"><img class="logo" src="assets/images/logo.png" alt=""
                      title=""></a></div>
              </div>

              <div class="nav-outer">
                <!-- Main Menu -->
                <nav class="main-menu navbar-expand-md">
                  <div class="navbar-header">
                    <!-- Toggle Button -->
                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                      data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                      aria-label="Toggle navigation">
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                    </button>
                  </div>
                  <div class="navbar-collapse collapse clearfix" id="navbarSupportedContent">
                    <ul class="navigation clearfix">
                      <li class="dropdown"><a href="index.html">Home</a>

                      </li>
                      <li><a href="courses.html">Courses</a></li>
                      <li><a href="certificate.html">Certificate</a></li>
                      <li><a href="scholars.html">Scholars</a></li>
                      <li><a href="about.html">About</a></li>
                      <li><a href="contact.html">Contact</a></li>
                    </ul>
                  </div>
                </nav>
              </div>

              <!-- Main Menu End-->
              <div class="outer-box d-flex align-items-center flex-wrap">

                <!-- Search Btn -->
                <div class="search-box-btn search-box-outer"><span class="icon fa fa-search"></span></div>

                <!-- User Box -->
                <a class="user-box theme-btn" href="login.html">
                  <span class="fa-regular fa-user fa-fw"></span>
                </a>

                <!-- Button Box -->
                <div class="header_button-box">
                  <a href="login.html" class="theme-btn btn-style-one">
                    <span class="btn-wrap">
                      <span class="text-one">Quick Join Now</span>
                      <span class="text-two">Quick Join Now</span>
                    </span>
                  </a>
                </div>

                <!-- Mobile Navigation Toggler -->
                <div class="mobile-nav-toggler"><span class="icon flaticon-menu"></span></div>
              </div>

            </div>
          </div>
        </div>
      </div>
      <!--End Header Upper-->

      <!-- Mobile Menu  -->
      <div class="mobile-menu">
        <div class="menu-backdrop"></div>
        <div class="close-btn"><span class="icon flaticon-close-1"></span></div>

        <nav class="menu-box">
          <div class="nav-logo"><a href="index.html"><img src="assets/images/logo.png" alt="" title=""></a></div>
          <div class="menu-outer"><!--Here Menu Will Come Automatically Via Javascript / Same Menu as in Header--></div>
        </nav>
      </div>
      <!-- End Mobile Menu -->

    </header>

    <div class="content-wrapper">
      <!-- Profile Information -->
      <div class="section-card">
        <h3 class="section-title">
          <div class="section-icon"><i class="fas fa-id-card"></i></div>
          Profile Information
        </h3>
        <div id="profileInfo" class="info-grid">
          <div class="info-item">
            <span class="info-label"><i class="fas fa-hashtag me-2"></i>Roll No:</span>
            <span class="info-value">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="fas fa-user me-2"></i>Name:</span>
            <span class="info-value">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="fas fa-envelope me-2"></i>Email:</span>
            <span class="info-value">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="fas fa-star me-2"></i>Points:</span>
            <span class="info-value">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="fas fa-level-up-alt me-2"></i>Level:</span>
            <span class="info-value">Loading...</span>
          </div>
        </div>
      </div>

      <!-- Course Progress -->
      <div class="section-card">
        <h3 class="section-title">
          <div class="section-icon"><i class="fas fa-graduation-cap"></i></div>
          Course Progress
        </h3>
        <div id="courseProgress">
          <div class="no-data">Loading courses...</div>
        </div>
      </div>

      <!-- Referrals -->
      <div class="section-card">
        <h3 class="section-title">
          <div class="section-icon"><i class="fas fa-users"></i></div>
          Your Referrals
        </h3>
        <div class="referral-stats">
          <div class="stat-card">
            <div class="stat-number" id="referralCount">0</div>
            <div class="stat-label">Total Referrals</div>
          </div>
        </div>
        <div id="referrals">
          <div class="no-data">Loading referrals...</div>
        </div>
      </div>

      <!-- Notifications -->
      <div class="section-card">
        <h3 class="section-title">
          <div class="section-icon"><i class="fas fa-bell"></i></div>
          Notifications
        </h3>
        <div id="notifications">
          <div class="no-data">No notifications...</div>
        </div>
      </div>

      <button id="logoutBtn" class="logout-btn">
        <i class="fas fa-sign-out-alt me-2"></i>Logout
      </button>
    </div>
  </div>
<script src="config.js"></script>
  <script>
    // Check authentication
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = 'login.html';
    }

    let userId = null;
    // Fetch profile data
    fetch(window.API_BASE_URL + '/api/auth/profile', {
      headers: { Authorization: 'Bearer ' + token }
    })
      .then(res => {
        if (!res.ok) throw new Error('Not authorized');
        return res.json();
      })
      .then(data => {
        userId = data.id || null;
        // Update profile information
        document.getElementById('profileInfo').innerHTML = `
          <div class="info-item">
            <span class="info-label"><i class="fas fa-hashtag me-2"></i>Roll No:</span>
            <span class="info-value">${data.roll_no || 'Not Available'}</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="fas fa-user me-2"></i>Name:</span>
            <span class="info-value">${data.name || 'Not Available'}</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="fas fa-envelope me-2"></i>Email:</span>
            <span class="info-value">${data.email || 'Not Available'}</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="fas fa-star me-2"></i>Points:</span>
            <span class="info-value">${data.points || '0'}</span>
          </div>
          <div class="info-item">
            <span class="info-label"><i class="fas fa-level-up-alt me-2"></i>Level:</span>
            <span class="info-value">${data.level || 'Beginner'}</span>
          </div>
        `;

        // Update course progress
        if (data.courses && data.courses.length > 0) {
          document.getElementById('courseProgress').innerHTML = data.courses.map((course, idx) => {
            const percent = course.total_videos && course.completed_videos
              ? Math.round((course.completed_videos / course.total_videos) * 100)
              : 0;
            let certBtn = '';
            // Certificate buttons removed; only show status
            return `
              <div class="progress-item">
                <div class="progress-header">
                  <span class="course-name">${course.title}</span>
                  <span class="progress-percentage">${percent}%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: ${percent}%"></div>
                </div>
                <div class="mt-2">
                  <small class="text-muted">
                    ${percent === 100 ? '✅ Completed' : '🔄 In Progress'}
                    ${course.test_passed ? ' • 📝 Test Passed' : ''}
                    ${course.certificate_issued ? ' • 🏆 Certificate Issued' : ''}
                  </small>
                </div>
              </div>
            `;
          }).join('');
          // Add event listeners for Get Certificate and Download Certificate buttons
          setTimeout(() => {
            document.querySelectorAll('.get-cert-btn').forEach(btn => {
              btn.addEventListener('click', function() {
                const courseId = this.getAttribute('data-course');
                fetch(window.API_BASE_URL + '/api/test/certificate', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                  },
                  body: JSON.stringify({ course: courseId })
                })
                  .then(res => res.json())
                  .then(resp => {
                    if (resp.success) {
                      this.disabled = true;
                      this.textContent = 'Certificate Issued!';
                      this.classList.remove('btn-success');
                      this.classList.add('btn-secondary');
                      // Optionally, refresh profile data to update UI
                      setTimeout(() => window.location.reload(), 1200);
                    } else {
                      alert(resp.error || 'Could not issue certificate.');
                    }
                  })
                  .catch(() => alert('Server error. Please try again.'));
              });
            });
            // Download Certificate button logic
            document.querySelectorAll('.download-cert-btn').forEach(btn => {
              btn.addEventListener('click', function() {
                const courseId = this.getAttribute('data-course');
                fetch(`${window.API_BASE_URL}/api/test/certificate/download?course=${courseId}`, {
                  method: 'GET',
                  headers: {
                    'Authorization': 'Bearer ' + token
                  }
                })
                  .then(response => response.blob())
                  .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'certificate.pdf';
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    setTimeout(() => window.URL.revokeObjectURL(url), 1000);
                  })
                  .catch(() => alert('Could not download certificate.'));
              });
            });
          }, 100);
        } else {
          document.getElementById('courseProgress').innerHTML = '<div class="no-data">No courses started yet.</div>';
        }

        // Update referrals
        const referralCount = (data.referrals && data.referrals.length) ? data.referrals.length : 0;
        document.getElementById('referralCount').textContent = referralCount;

        // Store blocker roll numbers for quick lookup
        let blockerRolls = [];
        if (window.nData && window.nData.notifications) {
          blockerRolls = window.nData.notifications.map(n => n.blocker_roll_no);
        }

        if (data.referrals && data.referrals.length > 0) {
          document.getElementById('referrals').innerHTML = data.referrals.map(referral => {
            const isBlocker = blockerRolls.includes(referral.roll_no);
            return `
              <div class="referral-item">
                <div class="referral-avatar">${referral.name ? referral.name.charAt(0).toUpperCase() : '?'}</div>
                <div class="referral-info">
                  <h6>${referral.name || 'Unknown'}</h6>
                  <small>${referral.email || 'No email'} • Roll No: ${referral.roll_no || 'N/A'}</small>
                </div>
                ${isBlocker ? '<span class="text-danger ms-2" title="Blocking the chain"><i class="fas fa-exclamation-triangle"></i></span>' : ''}
              </div>
            `;
          }).join('');
        } else {
          document.getElementById('referrals').innerHTML = '<div class="no-data">No referrals yet.</div>';
        }

        // Fetch notifications for this user
        if (userId) {
          fetch(`${window.API_BASE_URL}/api/notifications/${userId}`)
            .then(res => res.json())
            .then(nData => {
              window.nData = nData; // Store globally for referral check
              if (nData.notifications && nData.notifications.length > 0) {
                document.getElementById('notifications').innerHTML = nData.notifications.map(n => `
                  <div class="info-item notification-item">
                    <span class="info-label"><i class="fas fa-exclamation-triangle me-2"></i></span>
                    <span class="info-value">${n.message}</span>
                  </div>
                `).join('');
              } else {
                document.getElementById('notifications').innerHTML = '<div class="no-data">No notifications.</div>';
              }
            })
            .catch(() => {
              document.getElementById('notifications').innerHTML = '<div class="no-data">Could not load notifications.</div>';
            });
        }
      })
      .catch(() => {
        alert('Session expired. Please login again.');
        localStorage.removeItem('token');
        window.location.href = 'login.html';
      });

    // Logout functionality
    document.getElementById('logoutBtn').onclick = function () {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('token');
        window.location.href = 'login.html';
      }
    };
    
  </script>
  <script src="assets/js/jquery.js"></script>
<script src="assets/js/popper.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/appear.js"></script>
<script src="assets/js/parallax.min.js"></script>
<script src="assets/js/tilt.jquery.min.js"></script>
<script src="assets/js/jquery.paroller.min.js"></script>
<script src="assets/js/wow.js"></script>
<script src="assets/js/jarallax.js"></script>
<script src="assets/js/swiper.min.js"></script>
<script src="assets/js/backtotop.js"></script>
<script src="assets/js/odometer.js"></script>
<script src="assets/js/parallax-scroll.js"></script>

<script src="assets/js/gsap.min.js"></script>
<script src="assets/js/SplitText.min.js"></script>
<script src="assets/js/ScrollTrigger.min.js"></script>
<script src="assets/js/ScrollToPlugin.min.js"></script>
<script src="assets/js/ScrollSmoother.min.js"></script>

<script src="assets/js/magnific-popup.min.js"></script>
<script src="assets/js/nav-tool.js"></script>
<script src="assets/js/jquery-ui.js"></script>
<script src="assets/js/element-in-view.js"></script>
<script src="assets/js/script.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>

</html>